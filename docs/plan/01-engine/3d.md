# 3D System

## File Structure
```
packages/engine/src/3d/
├── d3d.ts          # 3D mode and primitives
├── transform.ts    # 3D transforms
├── lighting.ts     # Lighting
└── model-loader.ts # Model loading (glTF, OBJ)
```

## Scope: Basic 3D Primitives

The 3D system provides basic primitive rendering and transforms, not a full 3D engine.

## 3D Mode Functions

| Function | Description |
|----------|-------------|
| `d3d_start()` | Enable 3D mode |
| `d3d_end()` | Disable 3D mode |

## Projection Functions

| Function | Description |
|----------|-------------|
| `d3d_set_projection(xfrom, yfrom, zfrom, xto, yto, zto, xup, yup, zup)` | Set camera |
| `d3d_set_projection_ext(...)` | Extended projection |
| `d3d_set_projection_ortho(x, y, w, h, angle)` | Orthographic |
| `d3d_set_projection_perspective(x, y, w, h, angle)` | Perspective |

## Primitive Drawing

| Function | Description |
|----------|-------------|
| `d3d_draw_block(x1, y1, z1, x2, y2, z2, tex, hrepeat, vrepeat)` | Draw box |
| `d3d_draw_cylinder(x1, y1, z1, x2, y2, z2, tex, hrepeat, vrepeat, closed, steps)` | Draw cylinder |
| `d3d_draw_cone(x1, y1, z1, x2, y2, z2, tex, hrepeat, vrepeat, closed, steps)` | Draw cone |
| `d3d_draw_ellipsoid(x1, y1, z1, x2, y2, z2, tex, hrepeat, vrepeat, steps)` | Draw ellipsoid |
| `d3d_draw_floor(x1, y1, z1, x2, y2, z2, tex, hrepeat, vrepeat)` | Draw floor |
| `d3d_draw_wall(x1, y1, z1, x2, y2, z2, tex, hrepeat, vrepeat)` | Draw wall |

## Transform Functions

| Function | Description |
|----------|-------------|
| `d3d_transform_set_identity()` | Reset transform |
| `d3d_transform_add_translation(x, y, z)` | Add translation |
| `d3d_transform_add_rotation_x(angle)` | Rotate X |
| `d3d_transform_add_rotation_y(angle)` | Rotate Y |
| `d3d_transform_add_rotation_z(angle)` | Rotate Z |
| `d3d_transform_add_scaling(xs, ys, zs)` | Add scale |
| `d3d_transform_stack_push()` | Push transform |
| `d3d_transform_stack_pop()` | Pop transform |

## Lighting Functions

| Function | Description |
|----------|-------------|
| `d3d_light_define_direction(ind, dx, dy, dz, col)` | Directional light |
| `d3d_light_define_point(ind, x, y, z, range, col)` | Point light |
| `d3d_light_enable(ind, enable)` | Enable light |
| `d3d_set_lighting(enable)` | Enable lighting |

## Model Functions

| Function | Description |
|----------|-------------|
| `d3d_model_create()` | Create model container |
| `d3d_model_destroy(mod)` | Destroy model |
| `d3d_model_load(mod, filename)` | Load glTF/OBJ |
| `d3d_model_draw(mod, x, y, z, tex)` | Draw model |

## Supported 3D Formats
- glTF (.gltf, .glb)
- OBJ (.obj)

## WebGL 2 Notes

Using WebGL 2 only:
- No WebGL 1 fallback
- Full shader support
- Vertex Array Objects
- Multiple render targets
- 3D textures (if needed)
